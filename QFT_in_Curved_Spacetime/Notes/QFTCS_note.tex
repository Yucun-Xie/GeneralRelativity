\documentclass[12pt]{article}
%\usepackage[english]{babel}
\usepackage{graphicx}
%\usepackage{framed}
%\usepackage[normalem]{ulem}
\usepackage{indentfirst}
\usepackage{amsmath,amsthm,amssymb,amsfonts}
\numberwithin{equation}{subsection}
\usepackage{mathtools}
\usepackage[italicdiff]{physics}
\usepackage[T1]{fontenc}
\usepackage{wrapfig}
\usepackage{lmodern,mathrsfs}
\usepackage[inline,shortlabels]{enumitem}
\setlist{topsep=2pt,itemsep=2pt,parsep=0pt,partopsep=0pt}
\usepackage[dvipsnames]{xcolor}
\usepackage[utf8]{inputenc}
%\usepackage[letterpaper, top=0.5in,bottom=0.2in, left=0.5in, right=0.5in, footskip=0.3in, includefoot]{geometry}
\usepackage[letterpaper,left=0.5in, right=0.5in,top=0.7in,bottom=1in,footskip=0.3in,includefoot]{geometry}
\usepackage[most]{tcolorbox}
\usepackage{tikz,tikz-3dplot,tikz-cd,tkz-tab,tkz-euclide,pgf,pgfplots}
\pgfplotsset{compat=newest}
\usepackage{multicol}
\usepackage[bottom,multiple]{footmisc} 
%\usepackage[backend=bibtex,style=numeric]{biblatex}
%\addbibresource{bibliography}
\usepackage{hyperref}
\usepackage[nameinlink]{cleveref} 
\usepackage[titletoc, toc, page]{appendix}
\usepackage{subfiles}



\newtheoremstyle{mystyle}{}{}{}{}{\sffamily\bfseries}{.\\}{ }{}
\newtheoremstyle{cstyle}{}{}{}{}{\sffamily\bfseries}{}{ }{\thmnote{#3}}

\theoremstyle{mystyle}{\newtheorem{definition}{Definition}[subsection]}
%\theoremstyle{mystyle}{\newtheorem{proposition}[definition]{Proposition}}
\theoremstyle{mystyle}{\newtheorem{theorem}[definition]{Theorem}}
%\theoremstyle{mystyle}{\newtheorem{lemma}[definition]{Lemma}}
%\theoremstyle{mystyle}{\newtheorem{corollary}[definition]{Corollary}}
\theoremstyle{mystyle}{\newtheorem*{remark}{Remark}}
%\theoremstyle{mystyle}{\newtheorem*{remarks}{Remarks}}
\theoremstyle{mystyle}{\newtheorem{example}{Example}[subsection]}
\theoremstyle{mystyle}{\newtheorem{examples}{Examples}[subsection]}
%\theoremstyle{definition}{\newtheorem*{exercise}{Exercise}}
\theoremstyle{mystyle}{\newtheorem{cthm}{}[subsection]}


\tcolorboxenvironment{definition}{boxrule=0pt,boxsep=0pt,colback={red!10},left=8pt,right=8pt,enhanced jigsaw, borderline west={2pt}{0pt}{red},sharp corners,before skip=10pt,after skip=10pt,breakable}
%\tcolorboxenvironment{proposition}{boxrule=0pt,boxsep=0pt,colback={Orange!10},left=8pt,right=8pt,enhanced jigsaw, borderline west={2pt}{0pt}{Orange},sharp corners,before skip=10pt,after skip=10pt,breakable}
\tcolorboxenvironment{theorem}{boxrule=0pt,boxsep=0pt,colback={MidnightBlue!10},left=8pt,right=8pt,enhanced jigsaw, borderline west={2pt}{0pt}{MidnightBlue},sharp corners,before skip=10pt,after skip=10pt,breakable}
\tcolorboxenvironment{example}{boxrule=0pt,boxsep=0pt,colback={Magenta!10},left=8pt,right=8pt,enhanced jigsaw, borderline west={2pt}{0pt}{Magenta},sharp corners,before skip=10pt,after skip=10pt,breakable}
\tcolorboxenvironment{examples}{boxrule=0pt,boxsep=0pt,colback={violet!10},left=8pt,right=8pt,enhanced jigsaw, borderline west={2pt}{0pt}{violet},sharp corners,before skip=10pt,after skip=10pt,breakable}
\tcolorboxenvironment{proof}{boxrule=0pt,boxsep=0pt,blanker,borderline west={2pt}{0pt}{CadetBlue!80!white},left=8pt,right=8pt,sharp corners,before skip=10pt,after skip=10pt,breakable}
\tcolorboxenvironment{remark}{boxrule=0pt,boxsep=0pt,blanker,borderline west={2pt}{0pt}{Cyan},left=8pt,right=8pt,before skip=10pt,after skip=10pt,breakable}
%\tcolorboxenvironment{remarks}{boxrule=0pt,boxsep=0pt,blanker,borderline west={2pt}{0pt}{Green},left=8pt,right=8pt,before skip=10pt,after skip=10pt,breakable}
%\tcolorboxenvironment{example}{boxrule=0pt,boxsep=0pt,blanker,borderline west={2pt}{0pt}{Black},left=8pt,right=8pt,sharp corners,before skip=10pt,after skip=10pt,breakable}
%\tcolorboxenvironment{examples}{boxrule=0pt,boxsep=0pt,blanker,borderline west={2pt}{0pt}{Black},left=8pt,right=8pt,sharp corners,before skip=10pt,after skip=10pt,breakable}
\tcolorboxenvironment{cthm}{boxrule=0pt,boxsep=0pt,colback={orange!10},left=8pt,right=8pt,enhanced jigsaw, borderline west={2pt}{0pt}{orange},sharp corners,before skip=10pt,after skip=10pt,breakable}
\tcolorboxenvironment{equation}{boxrule=0pt,boxsep=0pt,colback={Green!10},left=8pt,right=8pt,enhanced jigsaw, borderline west={2pt}{0pt}{Green},sharp corners,before skip=10pt,after skip=10pt,breakable}
\tcolorboxenvironment{align}{boxrule=0pt,boxsep=0pt,colback={blue!10},left=8pt,right=8pt,enhanced jigsaw, borderline west={2pt}{0pt}{blue},sharp corners,before skip=10pt,after skip=10pt,breakable}


\usepackage[explicit]{titlesec}
\titleformat{\section}{\fontsize{24}{30}\sffamily\bfseries}{\thesection}{20pt}{#1}
\titleformat{\subsection}{\fontsize{16}{18}\sffamily\bfseries}{\thesubsection}{12pt}{#1}
\titleformat{\subsubsection}{\fontsize{10}{12}\sffamily\large\bfseries}{\thesubsubsection}{8pt}{#1}

\titlespacing*{\section}{0pt}{5pt}{5pt}
\titlespacing*{\subsection}{0pt}{5pt}{5pt}
\titlespacing*{\subsubsection}{0pt}{5pt}{5pt}

\newcommand{\sectionbreak}{\clearpage} %Start every section on a new page
\newcommand{\tbf}[1]{\textbf{#1}}
\newcommand{\p}{\partial}
\newcommand{\id}{\mathrm{d}}
%\newcommand{\Disp}{\displaystyle}
%\newcommand{\qe}{\hfill\(\bigtriangledown\)}
%\DeclareMathAlphabet\mathbfcal{OMS}{cmsy}{b}{n}
%\setlength{\parindent}{0.2in}
%\setlength{\parskip}{0pt}
%\setlength{\columnseprule}{0pt}

\title{\huge\sffamily\bfseries Quantum Field Theory in/of Curved Spacetime}
\author{\Large\sffamily Yucun Xie}
\date{\sffamily \today}

\begin{document}

\setlength{\abovedisplayskip}{3pt}
\setlength{\belowdisplayskip}{3pt}
\setlength{\abovedisplayshortskip}{0pt}
\setlength{\belowdisplayshortskip}{0pt}
\maketitle

%Custom colors for different environments
\definecolor{contcol1}{HTML}{72E094}
\definecolor{contcol2}{HTML}{24E2D6}
\definecolor{convcol1}{HTML}{C0392B}
\definecolor{convcol2}{HTML}{8E44AD}

\begin{tcolorbox}[
    title=Contents, fonttitle=\huge\sffamily\bfseries\selectfont,
    interior style={left color=contcol1!40!white,right color=contcol2!40!white},
    frame style={left color=contcol1!80!white,right color=contcol2!80!white},
    coltitle=black,top=2mm,bottom=2mm,left=2mm,right=2mm,drop fuzzy shadow,enhanced,breakable]
  \makeatletter
  \@starttoc{toc}
  \makeatother
\end{tcolorbox}

\newpage










\begin{tcolorbox}[
    title=Conventions, fonttitle=\large\sffamily\bfseries\selectfont,
    interior style={left color=convcol1!40!white,right color=convcol2!40!white},
    frame style={left color=convcol1!80!white,right color=convcol2!80!white},
    coltitle=black,top=2mm,bottom=2mm,left=2mm,right=2mm,drop fuzzy shadow,enhanced,breakable]
  \begin{enumerate}

    \item Greek index (e.g. $\alpha, \beta, \mu, \nu$) run over time and space.
          %\item Events denoted by cursive capitals  (e.g. $\mathscr{A}, \mathscr{B}, \mathscr{E}$).
    \item Latin index (e.g. $ i, j, k$) run over space.
    \item Natural units ($c=1$).
    \item Einstein summation convention. \[ds^2 = g_{\mu \nu} dx^{\mu} dx^{\nu}=
            \sum_{\mu=0}^{n-1} \sum_{\nu=0}^{n-1}g_{\mu \nu} dx^{\mu} dx^{\nu}\]
    \item Metric signature $(+, -, -, -)$.

  \end{enumerate}
\end{tcolorbox}

\newpage





























%begin here ---------------------------------------------------------------------------------------------
\section{QFT in Flat Spacetime Revisit}
In this chapter, we will review the quantum field theory in flat spacetime and carefully distinguish
the concepts only valid in flat spacetime and the concepts that could be generalized to curved spacetime.
\subsection{Scalar Field Construction}

Consider a massive scalar field \(\phi(t,x^{i})\) defined in spacetime point \((t,x^{i})\) satisfying the \textbf{Klein-Gordon equation}:
\begin{equation}
  (\Box + m^2) \phi = 0
\end{equation}

\begin{remark}
  Here we use the metric sign convention \((+,-,-,-)\); if we used other sign convention, the Klein-Gordon equation
  would read \((\Box - m^2) \phi = 0\).
\end{remark}

where the d'Alembertian \(\Box\) is defined as \(\Box = g^{\mu\nu}\p_{\mu}\p_{\nu}\).
In this chapter, we assume the spacetime is flat, so \(g^{\mu\nu}=\eta^{\mu\nu}\).\par
This equation could be obtained from the Lagrangian density
\[\mathcal{L} = \frac{1}{2}(\eta^{\mu\nu} \phi_{,\mu} \phi_{,\nu}- m^2 \phi^2)\]
by demanding the variations of the action \[S = \int \mathcal{L}(x) \mathrm{d}^{n}x\] vanish.
\par
The solution of the Klein-Gordon equation satisfying
\[f_{\mathbf{k}}(t,\mathbf{x})= Ae^{i(\mathbf{k}\cdot \mathbf{x}-\omega t)}\]

The dispersion relation is \[\omega = \sqrt{(\mathbf{|k|}^2 + m^2 )}.\]
We can rewrite the above mode functions use four-wave vector \(k^{\mu}=(\omega,\mathbf{k})\):
\begin{equation}\label{112}
  f_{\mathbf{k}}(x^{\mu})= Ae^{-i(k_\mu x^\mu)}
\end{equation}
The above solution is very similar to the solution of harmonic oscillators. However, there is a significant difference:
A harmonic oscillator only has one independent solution because it has a fixed, unique frequency.
This feature no longer holds for fields theory because we have an infinite number solution for each value of \(k\).
Therefore, we should construct a general solution by constructing a complete, orthonormal set of modes that any solution
can express as a linear combination of modes.
To achieve this, first define the inner product of mode functions:
\begin{definition}[Klein-Gordon inner product]\label{kgi}
  \[(\phi_1,\phi_2)=-i\int_{\Sigma_t}\id^{n-1}x\;\left[\phi_1\p_t\phi^*_2-\phi_2^*\p_t\phi_1\right]\]
  Which is integral over constant-time hypersurface \(\Sigma_t\).
\end{definition}
From generalized Stoke's theorem:\[\int_{M}\id\omega=\int_{\p M}\omega\]
\hfill \break
it is easy to check that the inner product is independent of choose of the hypersurface.
By explicitly calculating the inner product:
\begin{align}
  \left(f_{\mathbf{k}},f_{\mathbf{k}'}\right)\propto
   & \left(e^{-ik^{\mu}x_{\mu}},e^{-ik'^{\nu}x_{\nu}}\right)                           \\
   & =-i\int_{\Sigma_t}\id^{n-1}x\;\left[e^{-i\omega t+\mathbf{k}\cdot\mathbf{x}}
  \p_{t}e^{i\omega' t-\mathbf{k'}\cdot\mathbf{x}}-e^{i\omega' t-\mathbf{k'}\cdot\mathbf{x}}
  \p_{t}e^{-i\omega t+\mathbf{k}\cdot\mathbf{x}}\right]                                \\
   & = -i\int_{\Sigma_t}\id^{n-1}x\;\left[e^{-i\omega t} e^{\mathbf{k}\cdot\mathbf{x}}
  \p_{t}e^{i\omega' t}e^{-\mathbf{k'}\cdot\mathbf{x}}-e^{i\omega' t}e^{-\mathbf{k'}\cdot\mathbf{x}}
  \p_{t}e^{-i\omega t}e^{\mathbf{k}\cdot\mathbf{x}}\right]                             \\
   & =\int_{\Sigma_t}\id^{n-1}x\;\left[e^{-i\omega t} e^{\mathbf{k}\cdot\mathbf{x}}
  \omega' e^{i\omega' t}e^{-\mathbf{k'}\cdot\mathbf{x}}+e^{i\omega' t}e^{-\mathbf{k'}\cdot\mathbf{x}}
  \omega e^{-i\omega t}e^{\mathbf{k}\cdot\mathbf{x}}\right]                            \\
   & =  e^{-i\omega t}e^{i\omega' t}(\omega'+\omega)\int_{\Sigma_t}\id^{n-1}x\;
  \left[ e^{\mathbf{k}\cdot\mathbf{x}}e^{-\mathbf{k'}\cdot\mathbf{x}}\right]           \\
   & =   e^{i(\omega'-\omega)t}(\omega'+\omega)\int_{\Sigma_t}\id^{n-1}x\;
  \left[ e^{(\mathbf{k}-\mathbf{k'})\cdot\mathbf{x}}\right]                            \\
   & =  e^{i(\omega'-\omega)t}(\omega'+\omega)(2\pi)^{n-1}
  \delta^{n-1}\left(\mathbf{k}-\mathbf{k'}\right)
\end{align}


we find that \(\left(f_{\mathbf{k}},f_{\mathbf{k}'}\right)=0\) for \(\mathbf{k}\neq\mathbf{k'}\).
Furthermore, if we choose the normalization constant \(A\) in eq \ref{112} as
\(\frac{1}{\sqrt{2\omega(2\pi)^{n-1}}}\), we find the mode function
\begin{equation}
  f_{\mathbf{k}}(x^{\mu})=\frac{e^{-ik_{\mu}x^{\mu}}}{\sqrt{2\omega(2\pi)^{n-1}}}
\end{equation}
obey
\begin{equation}
  \left(f_{\mathbf{k}},f_{\mathbf{k}'}\right)=\delta^{(n-1)}(\mathbf{k}-\mathbf{k}').
\end{equation}

Given our dispersion relation, \(\mathbf{k}\) only determines the absolute value of frequency.
However, we can require that all mode functions have positive frequency and still give a complete set of mode functions by
including complex conjugates \(f^*_{\mathbf{k}}(x^{\mu})\).

The positive frequency mode is defined as \[\frac{\p}{\p t}f_{\mathbf{k}}=-i\omega f_{\mathbf{k}}.\]
And the mode with negative frequency is \[\frac{\p}{\p t}f^*_{\mathbf{k}}=i\omega f^*_{\mathbf{k}}.\]

The negative frequency modes are orthogonal to the positive frequency modes:
\begin{equation}
  \left(f_{\mathbf{k}},f^*_{\mathbf{k}'}\right)=0.
\end{equation}
And they are orthonormal with each other with a negative norm:
\begin{equation}
  \left(f^*_{\mathbf{k}},f^*_{\mathbf{k}'}\right)=-\delta^{(n-1)}(\mathbf{k}-\mathbf{k'})
\end{equation}
Hence, modes \(f_{\mathbf{k}}\) and \(f^*_{\mathbf{k}}\) form a complete set, which any possible solution
of Klein-Gordon equation can be expressed in terms of them.

\newpage
\subsection{Canonical Quantization}

The system could be quantized in the canonical quantization scheme by treating the field \(\phi\) as an operator \(\hat{\phi}\),
then impose the canonical commutation relations on equal-time hypersurface:
\begin{definition}[Canonical commutation relation]\label{121}
  \begin{align*}
    \bigl[\hat{\phi}(t,\mathbf{x}),\hat{\phi}(t,\mathbf{x'})\bigr] & =0                                       \\
    \bigl[\hat{\pi}(t,\mathbf{x}),\hat{\pi}(t,\mathbf{x'})\bigr]   & =0                                       \\
    \bigl[\hat{\phi}(t,\mathbf{x}),\hat{\pi}(t,\mathbf{x'})\bigr]  & =i\delta^{(n-1)}(\mathbf{x}-\mathbf{x'})
  \end{align*}
\end{definition}
The first two commutation relations come from the causality requirement, as those operators have spacelike separation.
The delta function implies that field and momentum operators commute everywhere except the spacetime point they intersect.
Just like the classical solution of the Klein-Gordon equation can be expanded in terms of mode,
the field operator \(\hat{\phi}\) also can be expanded in term mode function and have coefficients \(\hat{a}_{\mathbf{k}}\) and
\(\hat{a}^{\dagger}_{\mathbf{k}}\) respectively as shown below:
\begin{cthm}[Mode expansion]
  \[\phi(t,\mathbf{x})=\int\id^{n-1}k\left[\hat{a}_{\mathbf{k}}f_{\mathbf{k}}(t,\mathbf{x})+
    \hat{a}^{\dagger}_{\mathbf{k}}f^*_{\mathbf{k}}(t,\mathbf{x})\right]\]
\end{cthm}
By using the commutation relation defined in \ref{121}, we can obtain the commutation relation of operator \(\hat{a}_{\mathbf{k}}\) and
\(\hat{a}^{\dagger}_{\mathbf{k}}\):


\begin{align}
  \bigl[\hat{a}_{\mathbf{k}},\hat{a}_{\mathbf{k'}}\bigr]                     & =0                                      \\
  \bigl[\hat{a}^{\dagger}_{\mathbf{k}},\hat{a}^{\dagger}_{\mathbf{k'}}\bigr] & =0                                      \\
  \bigl[\hat{a}_{\mathbf{k}},\hat{a}^{\dagger}_{\mathbf{k'}}\bigr]           & =\delta^{(n-1)}(\mathbf{k}-\mathbf{k'})
\end{align}


Analog to harmonic oscillators, the operator \(\hat{a}_{\mathbf{k}}\) and
\(\hat{a}^{\dagger}_{\mathbf{k}}\) are annihilation and creation operator respectively.
The only difference is that we now have an infinite set of annihilation and creation operators corresponding to each spatial wave vector \(\mathbf{k}\).
%We can use annihilation and creation operators to define a basis for Hilbert space where the basis state is an eigenstate of number operator \(\)

\begin{remark}
  The quantization process described above is sometimes referred to as \tbf{second quantization}. Historically, this name
  comes from the fact that we first treat the mode as discrete and then have an integer number of excitation of each mode.
  However, the name ``second quantization'' can be misleading because the discrete mode is a classical phenomenon.
  We quantized the field exactly once.
\end{remark}


There is a single state \(\ket{0}\) that would be anihilated by all \(\hat{a}_{\mathbf{k}}\), called \tbf{vacuum}.
\begin{definition}[Vacuum]
  \[\forall\; \mathbf{k},\; \hat{a}_{\mathbf{k}}\ket{0}=0.\]
\end{definition}

A state with \(n\) particles with identical momentum \(\mathbf{k}\) can be constructed by repeat acting \(\hat{a}^{\dagger}_{\mathbf{k}}\)
on the vacuum:
\begin{equation}
  \ket{n_{\mathbf{k}}}=\frac{1}{\sqrt{n_{\mathbf{k}}!}}\left(\hat{a}^{\dagger}_{\mathbf{k}}\right)^{n}\ket{0}
\end{equation}

Similarly, we can construct a state with \(n_{i}\) particle for momentum \(\mathbf{k}_i\):
\begin{equation}
  \ket{n_1,n_2,\cdots,n_j}=\frac{1}{\sqrt{n_1!n_2!\cdots n_j!}}\left(\hat{a}^{\dagger}_{\mathbf{k}_1}\right)^{n_1}
  \left(\hat{a}^{\dagger}_{\mathbf{k}_2}\right)^{n_2}\cdots \left(\hat{a}^{\dagger}_{\mathbf{k}_j}\right)^{n_j}\ket{0}
\end{equation}

We can create or annihilate particles with certain momentum:
\begin{example}
  \begin{align*}
    \hat{a}_{\mathbf{k}_i}\ket{n_1,n_2,\cdots,n_i,\cdots,n_j}=           & \sqrt{n_i}\ket{n_1,n_2,\cdots,n_i-1,\cdots,n_j}   \\
    \hat{a}^{\dagger}_{\mathbf{k}_i}\ket{n_1,n_2,\cdots,n_i,\cdots,n_j}= & \sqrt{n_i+1}\ket{n_1,n_2,\cdots,n_i+1,\cdots,n_j} \\
  \end{align*}
\end{example}

Furthermore, we can define \tbf{number operator}:
\begin{definition}[Number operator]
  \[\hat{n}_{\mathbf{k}}=\hat{a}^\dagger_{\mathbf{k}}\hat{a}_{\mathbf{k}}\]
\end{definition}

Which obeys:
\begin{equation}
  \hat{n}_{\mathbf{k}_i}\ket{n_1,n_2,\cdots,n_i,\cdots,n_j}=    n_i\ket{n_1,n_2,\cdots,n_i,\cdots,n_j}
\end{equation}

The eigenstates of the number operator form a basis span Hilbert space, known as \tbf{Fock basis}.
The space span by this basis is called \tbf{Fock space}.

To illustrate the essential difference between flat and curved spacetime, we will examine how the Fock basis behaves under Lorentz transformation.
Consider a boost along \(x\) direction; the time derivative in the boosted frame is:
\begin{align}\label{pg}
  \p_{t'}f_{\mathbf{k}} & =\frac{\p x^{\mu}}{\p t'}\p_{\mu}f_{\mathbf{k}}                                   \\
                        & =\gamma(-i\omega)f_{\mathbf{k}}+\gamma\mathbf{v}\cdot (i\mathbf{k})f_{\mathbf{k}} \\
                        & =-i\omega'f_{\mathbf{k}}
\end{align}
where \[\omega'=\gamma\omega-\gamma\mathbf{v}\cdot \mathbf{k}\].
Hence, a state describing a collection of particles in the boosted frame would describe the identical particles with boosted momentum.
Therefore, the number operator in the boosted frame is identical to the original number operator; then, the vacuum will also be the same.
This particular result is due to the existence of a timelike Killing vector in flat spacetime, a direct consequence of Poincare symmetry.
With Poincare symmetry, our original choice of the inertial frame would be irrelevant.
Therefore, all inertial observers agree with a unique, single vacuum state.
\newpage
\subsection{Vacuum Energy}
The energy-momentum tensor of scalar field theory can be constructed in a standard manner:
\begin{align}
  T_{\mu\nu} & =\frac{2}{\sqrt[]{-g}}\frac{\delta S}{\delta(g^{\mu\nu})}                                         \\
             & =\phi_{,\mu}\phi_{,\nu}-\frac{1}{2}\eta_{\mu\nu}\eta^{\lambda\sigma}\phi_{,\lambda}\phi_{,\sigma}
  +\frac{1}{2}m^2\phi^2\eta_{\mu\nu}
\end{align}
The Hamiltonian operator can be obtained from the classical theory of field in the same manner.
Recall the Hamiltonian of Klein-Gordon field is:
\begin{equation}
  H=\int\id^3x\;\mathcal{H}=\int\id^3x\;T_{tt}=\int\id^3x\left[\frac{1}{2}\pi^2+\frac{1}{2}(\nabla\phi)^2+\frac{1}{2}m^2\phi^2\right]
\end{equation}
By substituting the mode expansion of \(\hat{\phi}\), we obtained the expression of Hamiltonian of quantized K-G field:
\begin{align}
  \hat{H}=\frac{1}{2}\int \id^{n-1}k\left[\hat{a}^{\dagger}_{\mathbf{k}}\hat{a}_{\mathbf{k}}+\hat{a}_{\mathbf{k}}\hat{a}^{\dagger}_{\mathbf{k}}\right]\omega
\end{align}
Use the commutation relation of \(\hat{a}_{\mathbf{k}}\) and \(\hat{a}^{\dagger}_{\mathbf{k}}\), we can further simplify the Hamiltonian operator:
\begin{align}\label{134}
  \hat{H} & =\int \id^{n-1}k\left[\hat{a}^{\dagger}_{\mathbf{k}}\hat{a}_{\mathbf{k}}+\frac{1}{2}\delta^{(n-1)}(0)\right]\omega \\
          & =\int \id^{n-1}k\left[\hat{a}^{\dagger}_{\mathbf{k}}\hat{a}_{\mathbf{k}}\omega\right]+
  \int \id^{n-1}k\left[\frac{1}{2}\delta^{(n-1)}(0)\omega\right]
\end{align}
The problem has arisen: if we calculate the expectation value of Hamiltonian in the vacuum state, one would expect to get 0,
however, we get infinite.
The vacuum has infinite energy!
The first reason we see infinite vacuum energy is that we are integral over all space. This is reasonable, analog
to harmonic oscillator zero point energy,
if we sum over infinite many ground state harmonic oscillators, we are expecting infinite energy.
The divergences caused by infinitely large space are often referred to as \tbf{infrared divergences}.
We can eliminate this kind of infinite through \tbf{regularization}.
Let confine the field in a box with length \(L\) by imposing periodic boundary conditions, and rewrite the second term in \ref{134} as:
\begin{equation}\label{135}
  \int \id^{n-1}k\left[\frac{1}{2}\delta^{(n-1)}(0)\omega\right]\rightarrow\frac{1}{2}\left[\frac{L}{2\pi}\right]^{n-1}\sum_{\mathbf{k}}\omega
\end{equation}
We have used the Fourier transform of \(\delta\) function.

However, after we restrict the vacuum in a finite region, the expression in \ref{135} is still divergent.
Since the value of \(\omega=\sqrt{|\mathbf{k}|^2+m^2}\) can be arbitrarily large.
This infinite arises because we assumed quantum field theory is valid for arbitrarily high frequency/energy
which corresponds to arbitrarily short distance. We expect to see new physics at that energy scale!
The divergences caused by infinitely high frequency are often referred to as \tbf{ultraviolet divergences}.
We can eliminate this kind of infinite through \tbf{renormalization}.
The simplified idea is just substrating off infinite from our expression.
This is valid because what we can measure in the experiment is the energy difference,
we can simply rescale the zero point of energy and not affect the observable.


\newpage

\subsection{Green Function}
Vacuum expectation values of various combinations of field operators can be treated with various Green functions of the Klein-Gordon equation.

For the K-G field, the expectation value of the commutator of the field operator can be represented by \tbf{Schwinger function} \(G(x^{\mu},x'^{\mu})\):
\begin{equation}
  iG(x^{\mu},x'^{\mu})=\expval{\left[\hat{\phi}(x^{\mu}),\hat{\phi}(x'^{\mu})\right]}{0}
\end{equation}
The anticommutator of field operator is defined as:
\begin{definition}[Anticommutator]
  \[\left\{\hat{\phi}(x^{\mu}),\hat{\phi}(x'^{\mu})\right\}=\hat{\phi}(x^{\mu})\hat{\phi}(x'^{\mu})+\hat{\phi}(x'^{\mu})\hat{\phi}(x^{\mu})\]
\end{definition}
The expectation value of anticommutator can be represented by \tbf{Hadamard's elementary function} \(G^{(1)}(x^{\mu},x'^{\mu})\):
\begin{equation}
  G^{(1)}(x^{\mu},x'^{\mu})=\expval{\left\{\hat{\phi}(x^{\mu}),\hat{\phi}(x'^{\mu})\right\}}{0}
\end{equation}
These Green functions can be split into positive and negative frequency parts:
\begin{align}
  iG(x^{\mu},x'^{\mu})      & = G^+(x^{\mu},x'^{\mu})-G^-(x^{\mu},x'^{\mu}) \\
  G^{(1)}(x^{\mu},x'^{\mu}) & =G^+(x^{\mu},x'^{\mu})+G^-(x^{\mu},x'^{\mu})
\end{align}
where \(G^{\pm}\) are \tbf{Wightman functions}, given by
\begin{cthm}[Wightman functions]
  \begin{align*}
    G^+(x^{\mu},x'^{\mu}) & =\expval{\hat{\phi}(x^{\mu})\hat{\phi}(x'^{\mu})}{0}  \\
    G^-(x^{\mu},x'^{\mu}) & =\expval{\hat{\phi}(x'^{\mu})\hat{\phi}(x^{\mu})}{0}.
  \end{align*}
\end{cthm}

Furthermore, the \tbf{Feynman propagator} \(G_{F}\) can be defined as the time-ordered product of fields operators:
\begin{cthm}[Feynman propagator]
  \begin{align*}
    iG_{F}(x^{\mu},x'^{\mu}) & =\expval{T(\hat{\phi}(x^{\mu})\hat{\phi}(x'^{\mu}))}{0}              \\
                             & =\theta(t-t')G^+(x^{\mu},x'^{\mu})+\theta(t'-t)G^-(x^{\mu},x'^{\mu})
  \end{align*}
\end{cthm}
Where \(\theta(t)\) is the \tbf{Heaviside step function}, defined as
\begin{definition}[Heaviside step function]
  \begin{equation*}
    \theta(t)=
    \begin{cases}
      1 & \text{if \(t>0\)}  \\
      0 & \text{if \(t<0\)}.
    \end{cases}
  \end{equation*}
\end{definition}
Using the step function, we can further define retarded and advanced Green functions:
\begin{cthm}[Retarded/Advanced Green functions]
  \begin{align*}
    G_{R}(x^{\mu},x'^{\mu}) & =-\theta(t-t')G(x^{\mu},x'^{\mu}) \\
    G_{A}(x^{\mu},x'^{\mu}) & =\theta(t-t')G(x^{\mu},x'^{\mu})
  \end{align*}
\end{cthm}
The average of retarded and advanced Green functions is denoted as
\begin{equation}
  \bar{G}(x^{\mu},x'^{\mu})=\frac{1}{2}\left[G_{R}(x^{\mu},x'^{\mu})+G_{A}(x^{\mu},x'^{\mu})\right].
\end{equation}
Then the Feynman propagator can be written as
\begin{equation}
  G_{F}(x^{\mu},x'^{\mu})=-\left[\bar{G}(x^{\mu},x'^{\mu})+\frac{1}{2}iG^{(1)}(x^{\mu},x'^{\mu})\right].
\end{equation}
The following relation holds for those Green functions:
\begin{equation}
  (\Box+m^2)
  \begin{bmatrix*}[l]
    G(x^{\mu},x'^{\mu})\\
    G^{(1)}(x^{\mu},x'^{\mu})\\
    G^{\pm}(x^{\mu},x'^{\mu})
  \end{bmatrix*}
  =0
\end{equation}

\begin{equation}
  (\Box+m^2)
  \begin{bmatrix*}[l]
    G_{F}(x^{\mu},x'^{\mu})\\
    G_{R}(x^{\mu},x'^{\mu})\\
    G_{A}(x^{\mu},x'^{\mu})
  \end{bmatrix*}
  =
  \begin{bmatrix*}[l]
    -\delta^n(x^{\mu}-x'^{\mu})\\
    \delta^n(x^{\mu}-x'^{\mu})\\
    \delta^n(x^{\mu}-x'^{\mu})
  \end{bmatrix*}
\end{equation}
All of those Green functions can be obtained by evaluating the contour integral:
\begin{equation}
  G_{all}=(2\pi)^{-n}\int_{C}\id^nk\;\frac{e^{i\left[\mathbf{k}\cdot(\mathbf{x}-\mathbf{x'})-k^0(t-t')\right]}}{(k^0)^2-|\mathbf{k}|^2-m^2}.
\end{equation}
This contour integral has poles at \(k^0=\pm \sqrt{(|\mathbf{k}|^2)+m^2}\).
The different Green functions take different contours, the contour for each Green function is shown in figure \ref{green}.

The opened contours in the figure should be closed by infinite semicircles in the lower/upper complex plane depending on boundary conditions.
For example, in the case that \(t'>t\), the contour for \(G_{R}(x^{\mu},x'^{\mu})\) is closed by a semicircle in the upper complex plane.
By residue theorem, this contour integral yields zero, which is expected.



\begin{figure}[ht]
  \def\crosslen{0.1}
  \begin{tikzpicture}[x=0.7cm, y=0.7cm,
    >={Latex[length=2.1mm]},
    cross/.pic={\draw[red] (-\crosslen, \crosslen)--(\crosslen,-\crosslen) (\crosslen, \crosslen)--(-\crosslen,-\crosslen);}]
    \def\xlen{7}
    \def\ylen{2.5}
    \def\mcenter{4.5}
    \def\mradius{1}
    \def\mbradius{1.8}
    \def\msradius{0.5}
    \def\deltaAngle{20}
    \def\mycolor{blue}

    \draw[->] (-\xlen,0) -- (\xlen,0) node[right]{Re$(z)$};
    \draw[->] (0, -\ylen)--(0,\ylen) node[above]{Im$(z)$};
    \draw[SeaGreen] (\mcenter,0) circle[radius=\mradius] pic{cross};
    \draw[\mycolor] (-\mcenter,0) circle[radius=\mradius] pic{cross};
    \draw[->, SeaGreen] (\mcenter,\mradius) node[above, black]{$\textcolor{SeaGreen}{iG^+}$}
    arc[radius=\mradius, start angle=90, delta angle=5];
    \draw[-<, \mycolor] (-\mcenter,\mradius) node[above, black]{$\textcolor{blue}{iG^-}$}
    arc[radius=\mradius, start angle=90, delta angle=5];

    \begin{scope}[yshift=-4.8cm]
      \draw[->] (-\xlen,0) -- (\xlen,0) node[right]{Re$(z)$};
      \draw[->] (0, -\ylen)--(0,\ylen) node[above]{Im$(z)$};
      \draw (\mcenter,0) pic{cross} (-\mcenter,0) pic{cross};
      \draw[SeaGreen] (\mcenter, \mradius) coordinate(upper point) arc[radius=\mradius, start angle=90, delta angle=-180] -- (-\mcenter, \mradius) arc[radius=\mradius, start angle=90, delta angle=180] -- cycle;
      \draw[\mycolor] (\mcenter, \mbradius) arc[radius=\mbradius, start angle=90, delta angle=-180] -- (-\mcenter, -\mbradius) arc[radius=\mbradius, start angle=-90, delta angle=-180] -- cycle;
      \draw[>-, \mycolor] (0.2*\mcenter, \mbradius) -- +(0.3*\mcenter,0) node[above, black]{$\textcolor{blue}{G}$};
      \draw[->, SeaGreen] (upper point) -- ($(upper point)!0.5!(0,0)$) node[above, black]{$\textcolor{SeaGreen}{iG^{(1)}}$};
    \end{scope}

    \begin{scope}[yshift=-9.6cm]
      \draw[->] (-\xlen,0) coordinate(xEnd) -- (\xlen,0)  coordinate(xStart) node[right]{Re$(z)$};
      \draw[->] (0, -\ylen)--(0,\ylen) node[above]{Im$(z)$};

      \draw (\mcenter,0) coordinate(circA) pic{cross} (-\mcenter,0) coordinate(circB) pic{cross};
      \draw[\mycolor] ($(circA)!1!\deltaAngle:(\msradius+\mcenter,0)$) coordinate(Spa)
      arc[radius=\msradius, start angle=\deltaAngle, end angle=180-\deltaAngle] -- ($(circB)!1!\deltaAngle:(\msradius-\mcenter,0)$)
      arc[radius=\msradius, start angle=\deltaAngle, end angle=180-\deltaAngle] -- (Spa -| xEnd) coordinate (myend);
      \draw[\mycolor] (Spa)--(Spa -| xStart) coordinate (mystart);
      \draw[->, \mycolor] ($(mystart)!0.4!(myend)$) node[above, black] {$\textcolor{blue}{G_R}$} -- ($(mystart)!0.56!(myend)$);

      \draw[SeaGreen] ($(circA)!1!-\deltaAngle:(\msradius+\mcenter,0)$) coordinate(Spa)
      arc[radius=\msradius, start angle=-\deltaAngle, end angle=-180+\deltaAngle] -- ($(circB)!1!-\deltaAngle:(\msradius-\mcenter,0)$)
      arc[radius=\msradius, start angle=-\deltaAngle, end angle=-180+\deltaAngle] -- (Spa -| xEnd) coordinate (myend);
      \draw[SeaGreen] (Spa)--(Spa -| xStart) coordinate (mystart);
      \draw[->, SeaGreen] ($(mystart)!0.4!(myend)$) node[below, black] {$\textcolor{SeaGreen}{G_A}$} -- ($(mystart)!0.46!(myend)$);

    \end{scope}


    \begin{scope}[yshift=-15cm]
      \draw[->] (-\xlen,0) coordinate(xEnd) -- (\xlen,0)  coordinate(xStart) node[right]{Re$(z)$};
      \draw[->] (0, -\ylen)--(0,\ylen) node[above]{Im$(z)$};
      \draw (\mcenter,0) coordinate(circA) pic{cross} (-\mcenter,0) coordinate(circB) pic{cross};
      \draw[\mycolor] ($(circA)!1!\deltaAngle:(\msradius+\mcenter,0)$) coordinate(Spa)
      arc[radius=\msradius, start angle=\deltaAngle, end angle=180-\deltaAngle] -- ($(circB)!1!\deltaAngle:(\msradius-\mcenter,0)$)
      arc[radius=\msradius, start angle=\deltaAngle, end angle=-180+\deltaAngle] coordinate(Spc) -- (Spc -| xEnd);
      \draw[\mycolor] (Spa)--(Spa -| xStart) coordinate (mystart);
      \coordinate (myend) at (Spa -| xEnd);
      \draw[-<, \mycolor] ($(mystart)!0.4!(myend)$) node[above, black] {$\textcolor{blue}{G_F}$} -- ($(mystart)!0.46!(myend)$);
    \end{scope}


  \end{tikzpicture}
  \centering
  \caption{Contour of different Green functions.}
  \label{green}
\end{figure}

The contour integral can be explicitly performed.
\begin{example}[Feynman propagator]
  The Feynman propagator can be evaluated as
  \begin{equation*}
    G_F(x^{\mu},x'^{\mu})=\frac{-\pi i}{(4\pi i)^{\frac{n}{2}}}\left[\frac{2m^2}{-\sigma+i\epsilon}\right]^{\frac{(n-2)}{4}}
    H^{(2)}_{\frac{1}{2}n-1}\left(\sqrt{2m^2(\sigma-i\epsilon)}\right).
  \end{equation*}

  Where \(\sigma=\frac{1}{2}(\Delta s)^2=\frac{1}{2}\eta_{\mu\nu}(x^{\mu}-x'^{\mu})(x^{\nu}-x'^{\nu})\) and
  \(H^{(2)}\) is the Hankel function of the second kind.

  The \(-i\epsilon\) is added to push the contour slightly down to the lower half complex plane, where the function is analytic.
\end{example}

We denote the massless limit case Green function by \(\mathcal{G}\) instead of \(G\).

\begin{example}[4-dimensional massless Feynman propagator]
  \[\mathcal{G}_F(x^{\mu},x^{\mu'})=\frac{i}{8\pi^2\sigma}-\frac{\delta(\sigma)}{8\pi}\]
\end{example}
\begin{example}[4-deimensional massless Hadamard's elementary function]
  \[\mathcal{G}^{(1)}(x^{\mu},x^{\mu'})=-\frac{1}{4\pi^2\sigma}\]
\end{example}

All the Green functions above are calculated as expectation values of field operators in a pure state,
which are suitable for describing systems at zero temperature.
However, the system at non-zero temperature is described by a state that is statistically distributed over all pure states.
The Green functions for a non-zero temperature system are given by the average of
all pure states of the expectation value of the products of field operators in those pure states.

Suppose \(\ket{\psi_i}\) is a pure state and eigenstate of the Hamiltonian operator, then it will also be an eigenstate of the number operator.
Because both numbers of particles and energy are variable, an equilibrium system at temperature \(T\) should be described by a grand canonical ensemble of states.
The probability of the system in the state \(\ket{\psi_i}\) is given by grand partition function:
\begin{cthm}
  \[\rho_i=\frac{e^{-\beta (E_i-\mu n_i)}}{Z}\]
  \\
  where \(\beta=\frac{1}{k_BT}\), \(\mu\) is chemical potential, \(Z=\sum_je^{-\beta(E_j-\mu n_j)}=e^{-\beta\Omega}\) is grand partition function,
  and \(\Omega\) is thermodynamic potential.
\end{cthm}
The \tbf{ensemble average} at a temperature given by \(\beta\) pf arbitrary operator \(\mathcal{\hat{O}}\) is given by
\begin{equation}\label{ea}
  \expval{\mathcal{\hat{O}}}_{\beta}=\sum_i\rho_i\expval{\mathcal{\hat{O}}}{\psi_i}.
\end{equation}
Define quantum density operator:
\begin{definition}[Density operator]
  \[\rho=e^{\beta(\Omega+\mu N-H)}\]
\end{definition}
then the probability of the system in the state \(\ket{\psi_i}\) is given by matrix element:
\begin{equation}
  \rho_i=\expval{\rho}{\psi_i}
\end{equation}
The probability should be normalized to 1:
\begin{equation}
  \tr\rho=\sum_i \expval{\rho}{\psi_i}=1
\end{equation}
eq \ref{ea} is reduced to
\begin{equation}
  \expval{\mathcal{\hat{O}}}_\beta=\tr \left(\rho\mathcal{\hat{O}}\right)
\end{equation}

Now we can define \tbf{thermal Green functions} by replacing the vacuum expectation values with the ensemble average.

\begin{example}[Thermal Wightman functions]
  \begin{align*}
    G^{+}_{\beta}(x^{\mu},x'^{\mu}) & =\expval{\hat{\phi}(x^{\mu})\hat{\phi}(x'^{\mu})}_{\beta}  \\
    G^{-}_{\beta}(x^{\mu},x'^{\mu}) & =\expval{\hat{\phi}(x'^{\mu})\hat{\phi}(x^{\mu})}_{\beta}.
  \end{align*}
\end{example}

When the chemical potential vanishes, we find an important property of thermal Green functions:
\begin{align}
  G^{+}_{\beta}(t,\mathbf{x};t',\mathbf{x'}) & =\frac{\tr\left[e^{-\beta H}\hat{\phi}(t,\mathbf{x})\hat{\phi}(t',\mathbf{x'})\right]}
  {\tr\left(e^{-\beta H}\right)}                                                                                                                             \\
                                             & =\frac{\tr\left[e^{-\beta H}\hat{\phi}(t,\mathbf{x})e^{\beta H}e^{-\beta H}\hat{\phi}(t',\mathbf{x'})\right]}
  {\tr\left(e^{-\beta H}\right)}                                                                                                                             \\
                                             & =\frac{\tr\left[\hat{\phi}(t+i\beta,\mathbf{x})e^{-\beta H}\hat{\phi}(t',\mathbf{x'})\right]}
  {\tr\left(e^{-\beta H}\right)}\label{he}                                                                                                                   \\
                                             & =\frac{\tr\left[e^{-\beta H}\hat{\phi}(t',\mathbf{x'})\hat{\phi}(t+i\beta,\mathbf{x})\right]}
  {\tr\left(e^{-\beta H}\right)}                                                                                                                             \\
                                             & =G^{-}_{\beta}(t+i\beta,\mathbf{x};t',\mathbf{x'})
\end{align}
In step \ref{he}, we have to use Heisenberg equations of motion
\begin{equation}
  \hat{\phi}(t,\mathbf{x})=e^{iH(t-t_0)}\hat{\phi}(t_0,\mathbf{x})e^{-i H(t-t_0)},
\end{equation}
and property of the trace
\begin{equation}
  \tr(AB)=\tr(BA)
\end{equation}

A similar property also holds for other Green functions.
\begin{example}[Wightman functions]
  \[G^{\pm}_{\beta}(t,\mathbf{x};t',\mathbf{x'})=G^{\mp}_{\beta}(t+i\beta,\mathbf{x};t',\mathbf{x'})\]
\end{example}

\begin{example}[Hadamard elementary function]
  \[G_{\beta}^{(1)}(t,\mathbf{x};t',\mathbf{x'})=G_{\beta}^{(1)}(t+i\beta,\mathbf{x};t',\mathbf{x'})\]
\end{example}
However, we should note that
\begin{equation}
  iG_{\beta}(t,\mathbf{x};t',\mathbf{x'})=iG(t,\mathbf{x};t',\mathbf{x'})=\left[\hat{\phi}(x^{\mu}),\hat{\phi}(x'^{\mu})\right].
\end{equation}
This property is due to the commutator of the free scalar field is not an operator but a number.
This does not usually hold for the interacting field.






\newpage

\section{QFT in Curved Spacetime}
In the Minkowski spacetime, we have a ``privileged'' set of basis related to Poincare symmetry which allows us to construct our mode function.
However, in general spacetime, the Poincare group no longer is the symmetry group, we do not have a set of mode functions that are preferred.
The consequence of no preferred mode functions is that the concepts of vacuum and particle are ill-defined.
The treatment in this chapter assumed that spacetime is globally hyperbolic.

\subsection{Construct QFT in Curved Spacetime}
Let us start with the Lagrangian density of a scalar field:
\[\mathcal{L} = \frac{1}{2}(\eta^{\mu\nu} \phi_{,\mu} \phi_{,\nu}- m^2 \phi^2)\]
To obtain the curved spacetime expression,
simply replace the Minkowski metric by \(g^{\mu\nu}\) and replace the partial derivative with the covariant derivative.
To involve the coupling to curved spacetime background, we also introduce a coupling term
\begin{equation}
  \mathcal{L} = \frac{1}{2}\sqrt{-g}(g^{\mu\nu} \phi_{;\mu} \phi_{;\nu}- m^2 \phi^2-\xi R \phi^2)
\end{equation}
Where the \(R\) is the Ricci scalar and \(\xi\) is the coupling constant.\par
There are two favorite choices of coupling constant:
\textbf{minimal coupling} which simply set \(\xi=0\) which turn off the coupling,
while \textbf{conformal coupling} sets \[\xi = \frac{(n-2)}{4(n-1)}\]\\
which makes the theory invariant under conformal transformation when \(m=0\).


The equation of motion obtained from the Euler-Lagrangian equation is
\begin{equation}
  \left[\Box+m^2+\xi R\right]\hat{\phi}=0
\end{equation}
The Klein-Gordon inner product \ref{kgi} in curved spacetime is generalized as
\begin{definition}[Curved spacetime Klein-Gordon inner product]
  \[(\phi_1,\phi_2)=-i\int_{\Sigma}\id^{n-1}x\;\sqrt{\gamma}n^{\mu}\left[\phi_1\nabla_\mu\phi^*_2-\phi_2^*\nabla_\mu\phi_1\right],\]
  where \(\gamma\equiv \det(\gamma_{ij})\) is the determinant of induced metric of hypersurface \(\Sigma\),
  and \(n^{\mu}\) is the unit normal vector of \(\Sigma\).
\end{definition}

We can proceed with the canonical quantization as in the previous chapter.
The conjugate momentum is
\begin{equation}
  \pi=\frac{\p \mathcal{L}}{\p(\nabla_{0}\phi)}=\sqrt{-g}\nabla_{0}\phi.
\end{equation}
Impose canonical commutation relation:
\begin{cthm}[Curved spacetime canonical commutation relation]\label{cccr}
  \begin{align*}
    \bigl[\hat{\phi}(t,\mathbf{x}),\hat{\phi}(t,\mathbf{x'})\bigr] & =0                                                          \\
    \bigl[\hat{\pi}(t,\mathbf{x}),\hat{\pi}(t,\mathbf{x'})\bigr]   & =0                                                          \\
    \bigl[\hat{\phi}(t,\mathbf{x}),\hat{\pi}(t,\mathbf{x'})\bigr]  & =\frac{i}{\sqrt{g}}\delta^{(n-1)}(\mathbf{x}-\mathbf{x'}).
  \end{align*}
\end{cthm}
We can just continue the procedure of constructing flat spacetime quantum field.

There exists a complete orthonormal set of modes, satisfying
\begin{align}\label{orf}
  \left(f_{i},f_{j}\right)     & =\delta_{ij}   \\
  \left(f_{i},f^*_{j}\right)   & =0             \\
  \left(f^*_{i},f^*_{j}\right) & =-\delta_{ij}.
\end{align}
The index \(ij\) represents some quantities that label the modes.
Because the set of modes is complete, we can expand our field as
\begin{cthm}[Mode expansion in curved spacetime]\label{cme}
  \[\hat{\phi}=\sum_i\left[\hat{a}_i f_i+\hat{a}_i^\dagger f_i^*\right].\]
\end{cthm}
The coefficients of mode expansion have commutation relations
\begin{align}
  \bigl[\hat{a}_{i},\hat{a}_{j}\bigr]                     & =0           \\
  \bigl[\hat{a}^{\dagger}_{i},\hat{a}^{\dagger}_{j}\bigr] & =0           \\
  \bigl[\hat{a}_{i},\hat{a}^{\dagger}_{j}\bigr]           & =\delta_{ij}
\end{align}
We interpret those coefficients as creation and annihilation operator, which defines a new vacuum state:
\begin{cthm}[\(f_i\) vacuum]
  \[\forall\;i,\ \hat{a}_i\ket{0_f}=0\]
\end{cthm}
Just like before, from this vacuum state, we can construct the Fock space.
A state with \(n_i\) excitations could be create by repeated action of \(\hat{a}^\dagger_i\),
\begin{equation}
  \ket{n_i}=\frac{1}{\sqrt{n_i!}}\left(\hat{a}_i^{\dagger}\ket{0_f}\right),
\end{equation}
and the number operator is
\begin{cthm}[Number operator of \(f_i\)]
  \[\hat{n}_{f_i}=\hat{a}_i^\dagger \hat{a}_i.\]
\end{cthm}

All the above constructions of Fock space and vacuum state are built for the set of modes \(f_i\).

\newpage
\subsection{Vacuum Ambiguity}
We should notice that our choice of mode function \(f_i\) is non-unique, and we can always construct another set of modes function
\(g_i\) and follow the procedure in the previous chapter, to construct the Fock space and vacuum state for the mode \(g_i\).

Before we discuss the issue of this ambiguity of mode in curved spacetime,
we first think about how this problem was avoided in Minkowski spacetime.

In Minkowski spacetime, the natural set of modes is associated with the Cartesian coordinate system \((t,x,y,z)\).
These coordinates are associated with the Killing vectors and Poincare group.
We have shown that the Fock space and vacuum state are invariant under the action of the Poincare group (c.f \ref{pg}).

More specifically, the positive frequency mode in Minkowski spacetime is defined through the Lie derivative along the
timelike Killing vector, \(\mathcal{L}_{\p t}f_{\mathbf{k}}=-i\omega f_{\mathbf{k}}\), and this timelike Killing vector
are associated with the Poincare group, so that we are always able to distinguish positive frequency and negative frequency modes in
flat spacetime.

Let's consider another set of modes \(g_i\), we can expand the field operator in term of \(g_i\):
\begin{cthm}[Alternative mode expansion]\label{ame}
  \[\hat{\phi}=\sum_i\left[\hat{\bar{a}}_i g_i+\hat{\bar{a}}_i^\dagger g_i^*\right].\]
\end{cthm}
Follow all procedures for mode \(f_i\), the commutation relation is imposed:
\begin{align}
  \bigl[\hat{\bar{a}}_{i},\hat{\bar{a}}_{j}\bigr]                     & =0           \\
  \bigl[\hat{\bar{a}}^{\dagger}_{i},\hat{\bar{a}}^{\dagger}_{j}\bigr] & =0           \\
  \bigl[\hat{\bar{a}}_{i},\hat{\bar{a}}^{\dagger}_{j}\bigr]           & =\delta_{ij}
\end{align}

The vacuum state of this set of annihilation operators is
\begin{cthm}[\(g_i\) vacuum]
  \[\forall\;i,\ \hat{\bar{a}}_i\ket{0_g}=0\]
\end{cthm}
The Fock basis is constructed by repeated action of creation operators on this vacuum, and the number operator is defined as
\begin{cthm}[Number operator of \(g_i\)]
  \[\hat{n}_{g_i}=\hat{\bar{a}}_i^\dagger \hat{\bar{a}}_i.\]
\end{cthm}

Both sets of modes are constructed in an equal way, and we don't know which one defined a vacuum that is more close to the physical vacuum.

Now, since both sets are complete, we can express one in terms of another, known as \tbf{Bogolubov transformation}.
\begin{definition}[Bogolubov transformation]\label{bt}
  \begin{align*}
    f_i & =\sum_j\left[\alpha^*_{ji}g_j-\beta_{ji}g^*_j\right] \\
    g_i & =\sum_j\left[\alpha_{ij}f_j+\beta_{ij}f_j^*\right]
  \end{align*}
  The matrix element \(\alpha_{ij}\) and \(\beta_{ij}\) are called \tbf{Bogolubov coefficients}
\end{definition}
Using the orthogonality of mode functions, \ref{orf}, we can compute the Bogolubov coefficients:
\begin{align}
  \alpha_{ij}&=(g_i,f_j)\\
\beta_{ij}&= -(g_i,f_j^*)
\end{align}
To make a physical mode function, the Bogolubov coefficients should be normalized:
\begin{align}
  \sum_j\bigl[\alpha_{ik}\alpha^*_{jk}-\beta_{ik}\beta^*_{jk}\bigr]&=\delta_{ij}\\
  \sum_j\bigl[\alpha_{ik}\beta_{jk}-\beta_{ik}\alpha_{jk}\bigr]&=0
\end{align}
To obtain the relation of creation/annihilation operators of set \(f_i\) and \(g_i\), 
we first equating the mode expansions \ref{cme} and \ref{ame}, and use Bogolubov transformation \ref{bt}.
\begin{equation}
  \sum_i\left[\hat{a}_i f_i+\hat{a}_i^\dagger f_i^*\right]=\sum_i\left[\hat{\bar{a}}_i g_i+\hat{\bar{a}}_i^\dagger g_i^*\right]
\end{equation}
We obtain 
\begin{align}
  \hat{a}_i &=\sum_j\left[\alpha_{ji}\hat{\bar{a}}_j+\beta^*_{ji}\hat{\bar{a}}^{\dagger}_j\right]\\
  \hat{\bar{a}}_i &=\sum_j\left[\alpha^*_{ij}\hat{a}_j-\beta^*_{ij}\hat{a}^{\dagger}_j\right]
\end{align}

Now imagine an observer in the vacuum state defined by mode \(f_i\), we want to know how many particles are there if the state is defined by \(g_i\) mode.
We should exam the expectation value of number operator of \(g_i\), \(\hat{n}_{g_i}\) in \(f_i\)-vacuum:
\begin{align}
  \expval{\hat{n}_{g_i}}{0_{f_i}}&=\expval{\hat{\bar{a}}_i^\dagger \hat{\bar{a}}_i}{0_{f_i}}\\
  &=\expval{\sum_{jk}\left(\alpha_{ij}\hat{a}^{\dagger}_j-\beta_{ij}\hat{a}_j\right)\left(\alpha^*_{ik}\hat{a}_k-\beta^*_{ik}\hat{a}^{\dagger}_k\right)}{0_{f_i}}\\
  &=\sum_{jk}\left(-\beta_{ij}\right)\left(-\beta^*_{ik}\right)\expval{\hat{a}_j\hat{a}^{\dagger}_k}{0_{f_i}}\\
  &=\sum_{jk}\left(\beta_{ij}\beta^*_{ik}\right)\expval{\hat{a}^{\dagger}_k\hat{a}_j+\delta_{jk}}{0_{f_i}}\\
  &=\sum_{jk}\left(\beta_{ij}\beta^*_{ik}\right)\delta_{jk}\braket{0_{f_i}}{0_{f_i}}\\
  &=\sum_{j}\beta_{ij}\beta^*_{ij}\\
  &=\sum_{j}|\beta_{ij}|^2
\end{align}
Hence, the number of particle in mode \(g_i\) in the \(f_i\)-vacuum is equal to \(\sum_{j}|\beta_{ij}|^2\).

Note that in some static spacetime, exist a timelike Killing vector \(\eta\), and if the modes \(f_i\) are positive frequency
modes satisfying
\begin{equation}
  \mathcal{L}_{\eta}f_i=-i\omega f_i,\quad \omega>0
\end{equation}
and Bogolubov coefficients \(\beta_{ij}\) vanish, i.e. the modes \(g_i\) are linear combination of \(f_i\) alone, 
two sets of modes share a common vacuum state.

\newpage

\subsection{Particle Detector}
To see what is the meaning of particles in curved spacetime, we consider the model of particle detector given by Unruh and Dewitt.

The \tbf{Unruh-Dewitt detector} is an idealized particle detector,
consisting of a point particle with internal energy level \(E\),
coupled via a monopole interaction with a scalar field \(\phi\).
Suppose the particle detector moves along the worldline described by parameterized function \(x^\mu(\tau)\),
where \(\tau\) is the detector's proper time.
The detector is point-like so the interaction only takes place at a point along the trajectory.

\par The detector-field interaction is described by the interaction Lagrangian:
\begin{equation}
  \mathcal{L}=\mathfrak{c} \hat{m}(\tau)\phi\left(x^{\mu}(\tau)\right)
\end{equation}

Where the \(\mathfrak{c}\) is the coupling constant and \(\hat{m}\) is the monopole moment of the detector.
In the Heisenberg picture, the time evolution of the monopole moment operator is governed by the Hamiltonian operator of the detector
\begin{equation}
  \hat{m}(\tau)= e^{i\hat{H}_d\tau}\hat{m}(0)e^{-i\hat{H}_d\tau}.
\end{equation}
where \(\hat{H}_d\ket{E}=E\ket{E}\).

Suppose the field \(\phi\) is in the Minkowski vacuum \(\ket{0}\), defined by \(a_{\mathbf{p}}\ket{0}=0\).
For the detector moves in a general trajectory,
it will not remain in the ground state \(E_0\) but will transition to an excited state \(E_n\) for \(n>0\),
while the field will transition to an excited state \(\ket{\psi}\). 

We assume that at initial time \(\tau_0\) the detector and field are in the product state \(\ket{0,E_0}=\ket{0}\otimes\ket{E_0}\).
In the interaction picture, the time evolution of this product state \(\ket{\psi}\) is governed by interaction Hamiltonian:
\begin{align}
  i\frac{\id }{\id \tau}\ket{\psi(\tau)}&=H_{int}\ket{\psi(\tau)}\\
  i\frac{\id }{\id \tau}\ket{\psi(\tau)}&=-\mathcal{L}_{int}\ket{\psi(\tau)}\\
  i\frac{\id }{\id \tau}\ket{\psi(\tau)}&=-\mathfrak{c} \hat{m}(\tau)\phi\left(x^{\mu}(\tau)\right)\ket{\psi(\tau)}
\end{align}

The transition amplitude from state \(\ket{0,E_0}\) at \(\tau=\tau_0\)
to state \(\ket{\psi,E_1}\) at \(\tau=\tau_1\) could be given by 
\begin{equation}
  \braket{\psi,E_1}{0,E_0}=\bra{\psi,E_1}\hat{T}\left[e^{-i\int_{\tau_0}^{\tau_1}\id \tau\;H_{int}(\tau)}\right]\ket{0,E_0}
\end{equation}
where \(\hat{T}\) is the time order operator.

If the coupling constant \(\mathfrak{c}\) is sufficiently small, the transition amplitude can be given by first-order perturbation theory:
\begin{align}\label{TA1}
  \braket{\psi,E_1}{0,E_0}&=i\mathfrak{c} \bra{\psi,E_1}\int_{\tau_0}^{\tau_1}d\tau\;
  \hat{m}(\tau)\phi\left(x^{\mu}(\tau)\right)\ket{0,E_{0}}\\
  &=i\mathfrak{c}\bra{E_1}m(0)\ket{E_0}\int_{\tau_0}^{\tau_1}\id \tau\;e^{i(E_1-E_0)\tau}\bra{\psi}\phi(x^{\mu}(\tau))\ket{0}.
\end{align}

If we want to calculate the transition probability to all possible states, we could square the expression \ref{TA1} and 
summing over the complete set of \(\ket{\psi_i}\), with resulting 
\begin{align}
  &\sum_{j}|\braket{\psi_j,E_1}{0,E_0}|^2\\
  &=\mathfrak{c}^2|\bra{E_1}m(0)\ket{E_0}|^2\int_{\tau_0}^{\tau_1}\id \tau
  \int_{\tau_0}^{\tau_1}\id \tau'e^{-i(E_1-E_0)(\tau-\tau')}\sum_{j}\bra{0}\hat{\phi}(x^{\mu}(\tau))\ket{\psi_j}\bra{\psi_j}\hat{\phi}(x^{\mu}(\tau'))\ket{0}\\
  &=\mathfrak{c}^2|\bra{E_1}m(0)\ket{E_0}|^2\int_{\tau_0}^{\tau_1}\id \tau
  \int_{\tau_0}^{\tau_1}\id \tau'e^{-i(E_1-E_0)(\tau-\tau')}\expval{\hat{\phi}(x^{\mu}(\tau))\hat{\phi}(x^{\mu}(\tau'))}{0}\\
  &=\underbrace{\mathfrak{c}^2|\bra{E_1}m(0)\ket{E_0}|^2}_{\text{sensitivity}}\underbrace{\int_{\tau_0}^{\tau_1}\id \tau
  \int_{\tau_0}^{\tau_1}\id \tau'e^{-i(E_1-E_0)(\tau-\tau')}G^+(x^{\mu}(\tau),x^{\mu}(\tau'))}_{\text{response function}}\label{det}
\end{align}
The equation \ref{det} contains two parts, sensitivity and response function. 
The sensitivity depends on the internal detail of the detector, and the response function does not. 
Therefore the response function is a general property for all such detectors.

Rewrite the \(E_1-E_0\) as \(\omega\), we may express the response function as 
\begin{cthm}[Response function]
  \[\mathcal{F}(\omega)=\int_{\tau_0}^{\tau_1}\id \tau\int_{\tau_0}^{\tau_1}\id \tau'e^{-i\omega(\tau-\tau')}G^+(x^{\mu}(\tau),x^{\mu}(\tau')) \]
\end{cthm}
In the special case in which the system is invariant under time translation in the detector's frame, the Wightman function could be written as 
\begin{equation}
  G^+(x^{\mu}(\tau),x^{\mu}(\tau'))=G^+(\tau-\tau')=G^+(\Delta \tau)
\end{equation}
This corresponds to the equilibrium between the detector and the field. 
In this case, the number of quanta absorbed or emitted by the detector per unit of proper time is constant. 
If these rates are nonzero, and we integrate over an infinite time interval, the transition probability will diverge.
Therefore, we should consider the transition probability per unit of proper time, given by 
\begin{equation}
  \mathfrak{c}^2|\bra{E_1}m(0)\ket{E_0}|^2\int_{-\infty}^{\infty}\id \Delta\tau e^{-i\omega\Delta \tau}G^+(\Delta \tau).
\end{equation}
%and demanding \(\tau_0 \rightarrow -\infty\) and \(\tau_1 \rightarrow \infty\)

%Factorized the equation \ref{TA1},

Let us now consider a few examples that the transition probability can be exactly evaluated. 



----------------------------







For an inertial detector in n-dimensional Minkowski spacetime, only the last term of xxx contributes to the detector response function:
\begin{equation}
  \frac{\mathcal{F}(E)}{T}=(2\pi)^{1-n}\int^{\infty}_{-\infty}\id (\Delta \tau)\;e^{-iE\Delta\tau}
  \int\frac{\id^{n-1}k}{2\omega}e^{i(\omega-\mathbf{k}\cdot\mathbf{v})\frac{\Delta\tau}{\sqrt{1-v^2}}}n_{\mathbf{k}}
\end{equation}
Where \(T\) is the duration of the detector switched on. If \(\mathbf{v}=0\) we can further perform the integration:
\begin{align}
  \frac{\mathcal{F}(E)}{T} & = (2\pi)^{1-n}\int^{\infty}_{-\infty}\id (\Delta \tau)\;e^{-i\Delta\tau E}
  \int\frac{\id^{n-1}k}{2\omega}e^{i\Delta\tau\frac{(\omega-\mathbf{k}\cdot\mathbf{v})}{\sqrt{1-v^2}}}n_{\mathbf{k}}        \\
                 & = (2\pi)^{1-n}\int\frac{\id^{n-1}k}{2\omega}\int^{\infty}_{-\infty}\id (\Delta \tau)\;e^{-i\Delta\tau E}
  e^{i\Delta\tau\frac{(\omega-\mathbf{k}\cdot\mathbf{v})}{\sqrt{1-v^2}}}n_{\mathbf{k}}                                      \\
                 & = (2\pi)^{1-n}\int\frac{\id^{n-1}k}{2\omega}\int^{\infty}_{-\infty}\id (\Delta \tau)\;
  e^{i\Delta\tau\frac{(\omega-\mathbf{k}\cdot\mathbf{v})}{\sqrt{1-v^2}}-i\Delta\tau E}n_{\mathbf{k}}                        \\
                 & = (2\pi)^{1-n}\int\frac{\id^{n-1}k}{2\omega}\int^{\infty}_{-\infty}\id (\Delta \tau)\;
  e^{i\Delta\tau\left[\frac{(\omega-\mathbf{k}\cdot\mathbf{v})}{\sqrt{1-v^2}}-E\right]}n_{\mathbf{k}}                       \\
                 & = (2\pi)^{1-n}(2\pi)\int\frac{\id^{n-1}k}{2\omega}\;
  \delta\left(\frac{(\omega-\mathbf{k}\cdot\mathbf{v})}{\sqrt{1-v^2}}-E\right)n_{\mathbf{k}}                                \\
                 & = (2\pi)^{1-n}(2\pi)\frac{2\pi^{\frac{n-1}{2}}}{\Gamma(\frac{n-1}{2})}\int\frac{k^{n-2}\id k}{2\omega}\;
  \delta\left(\omega-E\right)n_{\mathbf{k}}                                                                                 \\
                 & = \frac{2^{2-n}\pi^{\frac{3-n}{2}}}{\Gamma(\frac{n-1}{2})}\int\frac{k^{n-2}\id k}{\omega}\;
  \delta\left(\omega-E\right)n_{\mathbf{k}}                                                                                 \\
                 & = \frac{2^{2-n}\pi^{\frac{3-n}{2}}}{\Gamma(\frac{n-1}{2})}\int\frac{k^{n-2}\id k}{\sqrt{k^2+m^2}}\;
  \delta\left(\sqrt{k^2+m^2}-E\right)n_{\sqrt{E^2-m^2}}                                                                     \\
                 & = \frac{2^{2-n}\pi^{\frac{3-n}{2}}}{\Gamma(\frac{n-1}{2})}\left(E^2-m^2\right)^{\frac{n-3}{2}}
  \theta\left(E-m\right)n_{\sqrt{E^2-m^2}}
\end{align}




\section{Quantum Phenomena in Spacetime}


\subsection{Cosmological Particle Creation}



\subsection{Moving Mirror}


\subsection{Unruh Effect Revisit}
\subsection{Hawking Radiation}

%\section{Renormalization}

\newpage
\appendix
\addcontentsline{toc}{section}{Appendix~}





\section{Classical Field Theory}
\subfile{Appendix/Classical_Field_Theory}

\newpage
%\section{Driven Harmonic Oscillator}
\newpage



\end{document}